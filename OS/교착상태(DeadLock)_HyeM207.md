# 교착상태 (DeadLock)
## ▶ 📗 정의 
> 두 개 이상의 프로세스나 스레드가 `서로 자원을 얻지 못한 상태`에서 `무한히 다음 자원을 기다리게 되는 상태`

교착상태는 주로 한정된 시스템 자원을 여러 곳에서 사용하려고 할때 발생된다.  
한 프로세스가 자원을 요청했지만, 사용할 수 없게 되어 `대기`상태로 들어가게 되는데, 이때 다시 `실행` 상태로 변경될 수 없을때 `교착상태`가 발생한다. 

<br>

## ⚠ 교착상태(Deadlock) 발생 조건 

데드락 발생 조건은 4가지가 있는데, `모두 성립`해야 데드락이 발생했다고 말한다.   


### 📌 1. <b>상호배제 (Mutual Exclusion)</b> 
- 최소 한 개의 자원이 'nonsharable mode'에 있어야한다.  
- 즉, 한개의 스레드는 한번에 하나의 리소스만 사용할 수 있다는 의미이다. 만약 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야한다.
    

### 📌 2. <b>점유대기 (Hold and wait) </b> 
- <u>프로세스가 할당된 자원을 가진 상태에서 다른 자원 기다림</u>  
- 최소 하나의 자원을 점유하고 있으면서, 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 `대기하는 프로세스`가 존재해야 함

### 📌 3. <b>비선점 (No Preemption)</b> 
- 프로세스가 어떤 자원의 <u>사용이 끝날 때까지 그 자원을 강제로 뺏을 수 없음</u>  


### 📌 4. <b>순환대기 (Circular wait)</b>  
- <u>대기 프로세스 집합은 `순환 형태로 자원을 대기`하고 있어야 함</u>

<br>
<br>


## ✅ 교착상태(Deadlock) 해결방법 4가지 
> 예방, 회피, 탐지&회복, 무시

> 교착 상태를 예방&회피 or 교착 상태를 탐지&회복

### 📌 (1) 예방 (Deadlock prevention)
위의 데드락 발생 조건 4가지 중 하나라도 발생하지 않게 조치하는 것이 예방방법이다. 
- 상호배제 부정 : 한 번에 여러 프로세스가 공유 자원을 사용 가능하도록 공유 허용함
- 점유대기 부정 : 프로세스 실행 전 모든 자원을 할당함 (모든 자원에 대해 선점 허용)
- 비선점 조건 방지 : 자원 점유 중인 프로세스가 다른 자원을 요구할 때 가진 자원을 반납
- 순환 대기 조건 방지 : 모든 자원에 고유번호 할당 후 순서대로 자원 요청하도록 요구하는 것

<br>

### 📌 (2) 회피 (Deadlock avoidance)
교착 상태 발생 시 피해가는 방법으로, 자원 할당량을 사전에 파악하고 데드락을 회피하는 `은행원 알고리즘`이 있다.

은행원 알고리즘은 다익스트라가 제시한 기법으로, <b>미리 결정된 모든 자원들의 가능한 최대 할당량을 가지고 시뮬레이션 해서 safe state에 들 수 있는지 여부(=대기 중인 다른 프로세스들의 교착 상태 가능성)를 검사하는 알고리즘</b>이다.   

위 알고리즘을 이용하려면 미리 최대 자원 요구량을 알아야하고, 할당할 수 있는 자원의 수가 일정해야 된다는 등 사용에 있어 제약조건이 많다.

<br>

### 📌 (3) 탐지
데드락이 발생했는지 여부를 `현재 시스템의 자원 할당 상태`를 가지고 탐색한다.   
또는 `자원 할당 그래프(Resource-Allocation Graph)`를 통해 탐지하는 방법도 있다.

<br>

### 📌 (4) 회복
데드락에 걸린 프로세스를 종료하거나, 할당된 자원을 해제시켜 회복시키는 방법

#### [ 프로세스 종료 방법 ]
- 데드락인 프로세스 `모두` 중지
- 데드락이 제거될 때까지 `하나씩` 프로세스 중지

#### [ 자원 선점 방법 ]
- 데드락 상태의 프로세스가 점유하고 있는 자원을 선점하여, `다른 프로세스에게 할당`
- `우선순위가 낮은` 프로세스 or `수행 횟수가 적은` 프로세스 위주로 프로세스 자원 선점



<br>
<br>

### Reference
https://gyoogle.dev/blog/computer-science/operating-system/DeadLock.html   
https://chanhuiseok.github.io/posts/cs-2/
